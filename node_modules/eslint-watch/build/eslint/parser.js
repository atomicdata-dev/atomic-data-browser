"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _lodash = _interopRequireDefault(require("lodash.isempty"));

var _logger = require("../logger");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const logger = (0, _logger.createLogger)('eslint-help');
logger.debug('Loaded');
const namedOption = /^--/;
const header = /^(\w+(\s+)?)+\:$/i;

function parseNo(option, str) {
  if (!str) return;
  let cmd = str.replace('--', '');

  if (/no-/.test(cmd)) {
    logger.debug('Parsing no option', str);
    cmd = cmd.replace('no-', '');
    option.default = 'true';
  }

  option.option = cmd;
  return option;
}

function parseDouble(arr) {
  const description = arr.slice(2).filter(Boolean).join(' ');
  const [option, alias] = arr;
  return {
    option: option.replace('--', ''),
    type: 'Boolean',
    alias: alias.replace('--', ''),
    description: description
  };
}

function parseRegular(arr) {
  const [item] = arr;
  logger.debug('Parsing %s', item);

  if (!item) {
    return;
  }

  const [optionText] = arr;
  const type = arr[1] || 'Boolean';
  const option = parseNo({}, optionText);
  const helpText = arr.filter(a => a !== optionText && a !== type && a !== '');
  const description = helpText.join(' ');
  option.type = type;

  if (description) {
    option.description = description;
  }

  return option;
}

function parseAlias(arr = []) {
  const [alias] = arr;
  logger.debug('Alias found: %s', alias);
  const option = parseRegular(arr.filter(a => a !== alias));

  if (alias) {
    option.alias = alias.replace('-', '');
  }

  return option;
}

function createOption(arr) {
  let option;

  if (namedOption.test(arr[0]) && namedOption.test(arr[1])) {
    // negated boolean
    option = parseDouble(arr);
  } else if (namedOption.test(arr[0]) && !namedOption.test(arr[1])) {
    // no alias
    option = parseRegular(arr);
  } else {
    // aliased or other
    option = parseAlias(arr);
  }

  return (0, _lodash.default)(option) ? undefined : option;
}

function parseHelp(helpText) {
  return helpText.split('\n').reduce((acc, line, index) => {
    if (!line || index === 0) {
      return acc;
    }

    if (index === 0) {
      return acc;
    }

    if (header.test(line)) {
      acc.push({
        heading: line.replace(':', '')
      });
      return acc;
    }

    const lineArr = line.replace(',', '').trim().split(' ');
    const option = createOption(lineArr);

    if (option.option === 'help') {
      return acc;
    }

    acc.push(option);
    return acc;
  }, []);
}

var _default = {
  parseHelp: parseHelp
};
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lc2xpbnQvcGFyc2VyLmpzIl0sIm5hbWVzIjpbImxvZ2dlciIsImRlYnVnIiwibmFtZWRPcHRpb24iLCJoZWFkZXIiLCJwYXJzZU5vIiwib3B0aW9uIiwic3RyIiwiY21kIiwicmVwbGFjZSIsInRlc3QiLCJkZWZhdWx0IiwicGFyc2VEb3VibGUiLCJhcnIiLCJkZXNjcmlwdGlvbiIsInNsaWNlIiwiZmlsdGVyIiwiQm9vbGVhbiIsImpvaW4iLCJhbGlhcyIsInR5cGUiLCJwYXJzZVJlZ3VsYXIiLCJpdGVtIiwib3B0aW9uVGV4dCIsImhlbHBUZXh0IiwiYSIsInBhcnNlQWxpYXMiLCJjcmVhdGVPcHRpb24iLCJ1bmRlZmluZWQiLCJwYXJzZUhlbHAiLCJzcGxpdCIsInJlZHVjZSIsImFjYyIsImxpbmUiLCJpbmRleCIsInB1c2giLCJoZWFkaW5nIiwibGluZUFyciIsInRyaW0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7OztBQUVBLE1BQU1BLE1BQU0sR0FBRywwQkFBYSxhQUFiLENBQWY7QUFDQUEsTUFBTSxDQUFDQyxLQUFQLENBQWEsUUFBYjtBQUVBLE1BQU1DLFdBQVcsR0FBRyxLQUFwQjtBQUNBLE1BQU1DLE1BQU0sR0FBRyxtQkFBZjs7QUFFQSxTQUFTQyxPQUFULENBQWlCQyxNQUFqQixFQUF5QkMsR0FBekIsRUFBOEI7QUFDNUIsTUFBSSxDQUFDQSxHQUFMLEVBQVU7QUFFVixNQUFJQyxHQUFHLEdBQUdELEdBQUcsQ0FBQ0UsT0FBSixDQUFZLElBQVosRUFBa0IsRUFBbEIsQ0FBVjs7QUFFQSxNQUFJLE1BQU1DLElBQU4sQ0FBV0YsR0FBWCxDQUFKLEVBQXFCO0FBQ25CUCxJQUFBQSxNQUFNLENBQUNDLEtBQVAsQ0FBYSxtQkFBYixFQUFrQ0ssR0FBbEM7QUFDQUMsSUFBQUEsR0FBRyxHQUFHQSxHQUFHLENBQUNDLE9BQUosQ0FBWSxLQUFaLEVBQW1CLEVBQW5CLENBQU47QUFDQUgsSUFBQUEsTUFBTSxDQUFD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RUE0QkosRUE1QkksQ0FBUDtBQTZCRDs7ZUFFYztBQUNiSCxFQUFBQSxTQUFTLEVBQUVBO0FBREUsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBpc0VtcHR5IGZyb20gJ2xvZGFzaC5pc2VtcHR5JztcblxuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyIH0gZnJvbSAnLi4vbG9nZ2VyJztcblxuY29uc3QgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKCdlc2xpbnQtaGVscCcpO1xubG9nZ2VyLmRlYnVnKCdMb2FkZWQnKTtcblxuY29uc3QgbmFtZWRPcHRpb24gPSAvXi0tLztcbmNvbnN0IGhlYWRlciA9IC9eKFxcdysoXFxzKyk/KStcXDokL2k7XG5cbmZ1bmN0aW9uIHBhcnNlTm8ob3B0aW9uLCBzdHIpIHtcbiAgaWYgKCFzdHIpIHJldHVybjtcblxuICBsZXQgY21kID0gc3RyLnJlcGxhY2UoJy0tJywgJycpO1xuXG4gIGlmICgvbm8tLy50ZXN0KGNtZCkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1BhcnNpbmcgbm8gb3B0aW9uJywgc3RyKTtcbiAgICBjbWQgPSBjbWQucmVwbGFjZSgnbm8tJywgJycpO1xuICAgIG9wdGlvbi5kZWZhdWx0ID0gJ3RydWUnO1xuICB9XG5cbiAgb3B0aW9uLm9wdGlvbiA9IGNtZDtcblxuICByZXR1cm4gb3B0aW9uO1xufVxuXG5mdW5jdGlvbiBwYXJzZURvdWJsZShhcnIpIHtcbiAgY29uc3QgZGVzY3JpcHRpb24gPSBhcnJcbiAgICAuc2xpY2UoMilcbiAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgLmpvaW4oJyAnKTtcblxuICBjb25zdCBbb3B0aW9uLCBhbGlhc10gPSBhcnI7XG5cbiAgcmV0dXJuIHtcbiAgICBvcHRpb246IG9wdGlvbi5yZXBsYWNlKCctLScsICcnKSxcbiAgICB0eXBlOiAnQm9vbGVhbicsXG4gICAgYWxpYXM6IGFsaWFzLnJlcGxhY2UoJy0tJywgJycpLFxuICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbixcbiAgfTtcbn1cblxuZnVuY3Rpb24gcGFyc2VSZWd1bGFyKGFycikge1xuICBjb25zdCBbaXRlbV0gPSBhcnI7XG4gIGxvZ2dlci5kZWJ1ZygnUGFyc2luZyAlcycsIGl0ZW0pO1xuXG4gIGlmICghaXRlbSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IFtvcHRpb25UZXh0XSA9IGFycjtcbiAgY29uc3QgdHlwZSA9IGFyclsxXSB8fCAnQm9vbGVhbic7XG4gIGNvbnN0IG9wdGlvbiA9IHBhcnNlTm8oe30sIG9wdGlvblRleHQpO1xuICBjb25zdCBoZWxwVGV4dCA9IGFyci5maWx0ZXIoKGEpID0+IGEgIT09IG9wdGlvblRleHQgJiYgYSAhPT0gdHlwZSAmJiBhICE9PSAnJyk7XG4gIGNvbnN0IGRlc2NyaXB0aW9uID0gaGVscFRleHQuam9pbignICcpO1xuXG4gIG9wdGlvbi50eXBlID0gdHlwZTtcblxuICBpZiAoZGVzY3JpcHRpb24pIHtcbiAgICBvcHRpb24uZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgfVxuXG4gIHJldHVybiBvcHRpb247XG59XG5cbmZ1bmN0aW9uIHBhcnNlQWxpYXMoYXJyID0gW10pIHtcbiAgY29uc3QgW2FsaWFzXSA9IGFycjtcblxuICBsb2dnZXIuZGVidWcoJ0FsaWFzIGZvdW5kOiAlcycsIGFsaWFzKTtcbiAgY29uc3Qgb3B0aW9uID0gcGFyc2VSZWd1bGFyKGFyci5maWx0ZXIoKGEpID0+IGEgIT09IGFsaWFzKSk7XG5cbiAgaWYgKGFsaWFzKSB7XG4gICAgb3B0aW9uLmFsaWFzID0gYWxpYXMucmVwbGFjZSgnLScsICcnKTtcbiAgfVxuXG4gIHJldHVybiBvcHRpb247XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZU9wdGlvbihhcnIpIHtcbiAgbGV0IG9wdGlvbjtcblxuICBpZiAobmFtZWRPcHRpb24udGVzdChhcnJbMF0pICYmIG5hbWVkT3B0aW9uLnRlc3QoYXJyWzFdKSkge1xuICAgIC8vIG5lZ2F0ZWQgYm9vbGVhblxuICAgIG9wdGlvbiA9IHBhcnNlRG91YmxlKGFycik7XG4gIH0gZWxzZSBpZiAobmFtZWRPcHRpb24udGVzdChhcnJbMF0pICYmICFuYW1lZE9wdGlvbi50ZXN0KGFyclsxXSkpIHtcbiAgICAvLyBubyBhbGlhc1xuICAgIG9wdGlvbiA9IHBhcnNlUmVndWxhcihhcnIpO1xuICB9IGVsc2Uge1xuICAgIC8vIGFsaWFzZWQgb3Igb3RoZXJcbiAgICBvcHRpb24gPSBwYXJzZUFsaWFzKGFycik7XG4gIH1cblxuICByZXR1cm4gaXNFbXB0eShvcHRpb24pID8gdW5kZWZpbmVkIDogb3B0aW9uO1xufVxuXG5mdW5jdGlvbiBwYXJzZUhlbHAoaGVscFRleHQpIHtcbiAgcmV0dXJuIGhlbHBUZXh0LnNwbGl0KCdcXG4nKS5yZWR1Y2UoKGFjYywgbGluZSwgaW5kZXgpID0+IHtcbiAgICBpZiAoIWxpbmUgfHwgaW5kZXggPT09IDApIHtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfVxuICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9XG5cbiAgICBpZiAoaGVhZGVyLnRlc3QobGluZSkpIHtcbiAgICAgIGFjYy5wdXNoKHsgaGVhZGluZzogbGluZS5yZXBsYWNlKCc6JywgJycpIH0pO1xuXG4gICAgICByZXR1cm4gYWNjO1xuICAgIH1cblxuICAgIGNvbnN0IGxpbmVBcnIgPSBsaW5lXG4gICAgICAucmVwbGFjZSgnLCcsICcnKVxuICAgICAgLnRyaW0oKVxuICAgICAgLnNwbGl0KCcgJyk7XG5cbiAgICBjb25zdCBvcHRpb24gPSBjcmVhdGVPcHRpb24obGluZUFycik7XG5cbiAgICBpZiAob3B0aW9uLm9wdGlvbiA9PT0gJ2hlbHAnKSB7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH1cblxuICAgIGFjYy5wdXNoKG9wdGlvbik7XG5cbiAgICByZXR1cm4gYWNjO1xuICB9LCBbXSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgcGFyc2VIZWxwOiBwYXJzZUhlbHAsXG59O1xuIl19